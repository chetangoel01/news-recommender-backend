<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News Recommender API Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.8;
            font-size: 1.1em;
        }

        .main-content {
            padding: 30px;
        }

        .auth-section, .demo-section {
            margin-bottom: 40px;
            padding: 25px;
            border: 2px solid #e8f4fd;
            border-radius: 12px;
            background: #f8fbff;
        }

        .section-title {
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3498db;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        button {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            min-width: 140px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.2);
        }

        button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .success {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
        }

        .warning {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        }

        .danger {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 600;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .response-box {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 13px;
            white-space: pre-wrap;
        }

        .user-info {
            background: #e8f5e8;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #28a745;
        }

        .articles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .article-card {
            border: 1px solid #ddd;
            border-radius: 12px;
            padding: 20px;
            background: white;
            transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .article-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .article-card.bookmarked {
            border-left: 4px solid #f39c12;
            background: linear-gradient(135deg, #fff9e6 0%, #ffffff 100%);
        }

        .article-card.bookmarked::before {
            content: "üîñ";
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.2em;
        }

        .article-title {
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 10px;
            color: #2c3e50;
            line-height: 1.4;
        }

        .article-summary {
            color: #666;
            margin-bottom: 10px;
            line-height: 1.4;
        }

        .article-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9em;
            color: #888;
            border-top: 1px solid #eee;
            padding-top: 10px;
            margin-top: 15px;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid #eee;
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .tab.active {
            color: #3498db;
            border-bottom-color: #3498db;
            background: #f8fbff;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .button-group {
                flex-direction: column;
            }
            
            .articles-grid {
                grid-template-columns: 1fr;
            }
            
            .main-content {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üóûÔ∏è News Recommender API Demo</h1>
            <p>Test all endpoints of your news recommendation backend</p>
        </div>

        <div class="main-content">
            <!-- Authentication Section -->
            <div class="auth-section">
                <h2 class="section-title">üîê Authentication</h2>
                
                <div class="tabs">
                    <div class="tab active" onclick="switchTab('login')">Login</div>
                    <div class="tab" onclick="switchTab('register')">Register</div>
                </div>

                <!-- Login Tab -->
                <div id="login-tab" class="tab-content active">
                    <div class="form-group">
                        <label for="login-email">Email:</label>
                        <input type="email" id="login-email" placeholder="user@example.com" value="user@example.com">
                    </div>
                    <div class="form-group">
                        <label for="login-password">Password:</label>
                        <input type="password" id="login-password" placeholder="Password" value="password">
                    </div>
                    <button onclick="login()">Login</button>
                </div>

                <!-- Register Tab -->
                <div id="register-tab" class="tab-content">
                    <div class="form-group">
                        <label for="register-email">Email:</label>
                        <input type="email" id="register-email" placeholder="newuser@example.com">
                    </div>
                    <div class="form-group">
                        <label for="register-password">Password:</label>
                        <input type="password" id="register-password" placeholder="At least 8 characters">
                    </div>
                    <div class="form-group">
                        <label for="register-username">Username:</label>
                        <input type="text" id="register-username" placeholder="username123">
                    </div>
                    <div class="form-group">
                        <label for="register-display-name">Display Name:</label>
                        <input type="text" id="register-display-name" placeholder="John Doe">
                    </div>
                    <button onclick="register()">Register</button>
                </div>

                <div id="auth-status"></div>
                <div id="user-info" class="user-info hidden"></div>
            </div>

            <!-- Demo Section -->
            <div class="demo-section">
                <h2 class="section-title">üöÄ API Demo</h2>
                <p style="margin-bottom: 20px; padding: 15px; background: #e8f4fd; border-radius: 8px; border-left: 4px solid #3498db;">
                    <strong>‚ú® Complete API Demo:</strong> Test all engagement features including likes, shares, bookmarks, and ML personalization! 
                    Features individual user tracking for all interactions (shares are the strongest engagement signal for ML recommendations).
                </p>

                <div class="button-group">
                    <button onclick="getArticles()" id="get-articles-btn" disabled>Get Articles</button>
                    <button onclick="getUserProfile()" id="get-profile-btn" disabled>Get Profile</button>
                    <button onclick="updateProfile()" id="update-profile-btn" disabled>Update Profile</button>
                    <button onclick="getUserBookmarks()" id="get-bookmarks-btn" disabled>My Bookmarks</button>
                    <button onclick="getEmbeddingStatus()" id="get-embedding-btn" disabled>Embedding Status</button>
                    <button onclick="testEmbeddingUpdate()" id="test-embedding-btn" disabled>Test Embedding Update</button>
                    <button onclick="logout()" id="logout-btn" disabled>Logout</button>
                </div>

                <!-- Articles Filter -->
                <div id="articles-filters" class="hidden">
                    <h3>Article Filters:</h3>
                    <div style="display: flex; gap: 15px; margin: 15px 0; flex-wrap: wrap;">
                        <div>
                            <label for="category-filter">Category:</label>
                            <select id="category-filter">
                                <option value="">All Categories</option>
                                <option value="technology">Technology</option>
                                <option value="business">Business</option>
                                <option value="sports">Sports</option>
                                <option value="entertainment">Entertainment</option>
                                <option value="health">Health</option>
                            </select>
                        </div>
                        <div>
                            <label for="sort-filter">Sort:</label>
                            <select id="sort-filter">
                                <option value="recent">Recent</option>
                                <option value="trending">Trending</option>
                                <option value="relevance">Relevance</option>
                            </select>
                        </div>
                        <div>
                            <label for="limit-filter">Limit:</label>
                            <select id="limit-filter">
                                <option value="10">10</option>
                                <option value="20" selected>20</option>
                                <option value="50">50</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div id="response-container"></div>
                <div id="articles-container"></div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000';
        let currentToken = null;
        let currentUser = null;

        // Tab switching
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
        }

        // Utility functions
        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('auth-status');
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = message;
            statusDiv.style.display = 'block';
        }

        function showResponse(data, title = 'API Response') {
            const container = document.getElementById('response-container');
            container.innerHTML = `
                <h3>${title}:</h3>
                <div class="response-box">${JSON.stringify(data, null, 2)}</div>
            `;
        }

        function updateUserInfo(userData) {
            const userInfoDiv = document.getElementById('user-info');
            userInfoDiv.innerHTML = `
                <h3>üë§ Logged in as:</h3>
                <p><strong>Username:</strong> ${userData.username}</p>
                <p><strong>Display Name:</strong> ${userData.display_name || 'Not set'}</p>
                <p><strong>Email:</strong> ${userData.email || 'Not set'}</p>
                <p><strong>User ID:</strong> ${userData.user_id}</p>
            `;
            userInfoDiv.classList.remove('hidden');
        }

        function enableDemoButtons() {
            const buttons = ['get-articles-btn', 'get-profile-btn', 'update-profile-btn', 
                           'get-bookmarks-btn', 'get-embedding-btn', 'test-embedding-btn', 'logout-btn'];
            buttons.forEach(id => {
                document.getElementById(id).disabled = false;
            });
            document.getElementById('articles-filters').classList.remove('hidden');
        }

        function disableDemoButtons() {
            const buttons = ['get-articles-btn', 'get-profile-btn', 'update-profile-btn', 
                           'get-bookmarks-btn', 'get-embedding-btn', 'test-embedding-btn', 'logout-btn'];
            buttons.forEach(id => {
                document.getElementById(id).disabled = true;
            });
            document.getElementById('articles-filters').classList.add('hidden');
        }

        // API calls
        async function makeRequest(endpoint, options = {}) {
            const url = `${API_BASE}${endpoint}`;
            const defaultOptions = {
                headers: {
                    'Content-Type': 'application/json',
                },
            };

            if (currentToken) {
                defaultOptions.headers['Authorization'] = `Bearer ${currentToken}`;
            }

            const finalOptions = {
                ...defaultOptions,
                ...options,
                headers: {
                    ...defaultOptions.headers,
                    ...options.headers,
                },
            };

            try {
                const response = await fetch(url, finalOptions);
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.detail || `HTTP error! status: ${response.status}`);
                }
                
                return data;
            } catch (error) {
                console.error('API request failed:', error);
                throw error;
            }
        }

        // Authentication functions
        async function register() {
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const username = document.getElementById('register-username').value;
            const displayName = document.getElementById('register-display-name').value;

            if (!email || !password || !username || !displayName) {
                showStatus('Please fill all fields', 'error');
                return;
            }

            try {
                showStatus('Registering...', 'info');
                const data = await makeRequest('/auth/register', {
                    method: 'POST',
                    body: JSON.stringify({
                        email,
                        password,
                        username,
                        display_name: displayName
                    }),
                });

                currentToken = data.access_token;
                currentUser = data;
                
                showStatus('Registration successful!', 'success');
                showResponse(data, 'Registration Response');
                updateUserInfo(data);
                enableDemoButtons();
                
            } catch (error) {
                showStatus(`Registration failed: ${error.message}`, 'error');
            }
        }

        async function login() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;

            if (!email || !password) {
                showStatus('Please fill all fields', 'error');
                return;
            }

            try {
                showStatus('Logging in...', 'info');
                const data = await makeRequest('/auth/login', {
                    method: 'POST',
                    body: JSON.stringify({
                        email,
                        password
                    }),
                });

                currentToken = data.access_token;
                currentUser = data;
                
                showStatus('Login successful!', 'success');
                showResponse(data, 'Login Response');
                updateUserInfo(data);
                enableDemoButtons();
                
            } catch (error) {
                showStatus(`Login failed: ${error.message}`, 'error');
            }
        }

        function logout() {
            currentToken = null;
            currentUser = null;
            
            document.getElementById('user-info').classList.add('hidden');
            document.getElementById('auth-status').style.display = 'none';
            document.getElementById('response-container').innerHTML = '';
            document.getElementById('articles-container').innerHTML = '';
            
            disableDemoButtons();
            showStatus('Logged out successfully', 'success');
        }

        // Demo functions
        async function getArticles() {
            try {
                showStatus('Fetching articles...', 'info');
                
                const category = document.getElementById('category-filter').value;
                const sort = document.getElementById('sort-filter').value;
                const limit = document.getElementById('limit-filter').value;
                
                let queryParams = new URLSearchParams({
                    sort,
                    limit,
                    page: '1'
                });
                
                if (category) {
                    queryParams.append('category', category);
                }
                
                const data = await makeRequest(`/articles?${queryParams}`);
                
                showStatus('Articles fetched successfully!', 'success');
                showResponse(data, 'Articles Response');
                displayArticles(data.articles);
                
            } catch (error) {
                showStatus(`Failed to fetch articles: ${error.message}`, 'error');
            }
        }

        function displayArticles(articles) {
            const container = document.getElementById('articles-container');
            
            if (!articles || articles.length === 0) {
                container.innerHTML = '<p>No articles found.</p>';
                return;
            }
            
            container.innerHTML = `
                <h3>üì∞ Articles (${articles.length} found):</h3>
                <div class="articles-grid">
                    ${articles.map(article => `
                        <div class="article-card ${article.engagement?.user_bookmarked ? 'bookmarked' : ''}" onclick="getArticleDetails('${article.id}')">
                            <div class="article-title">${article.title}</div>
                            <div class="article-summary">${article.summary || 'No summary available'}</div>
                            <div class="article-meta">
                                <span>üì∞ ${article.source?.name || 'Unknown'}</span>
                                <span>üëÄ ${article.engagement?.views || 0} views</span>
                                <span>‚ù§Ô∏è ${article.engagement?.likes || 0} likes</span>
                                <span>üì§ ${article.engagement?.shares || 0} shares</span>
                                <span>üîñ ${article.engagement?.user_bookmarked ? 'Bookmarked' : 'Not bookmarked'}</span>
                            </div>
                            <div style="margin-top: 10px; display: flex; gap: 8px; flex-wrap: wrap;">
                                <button onclick="event.stopPropagation(); toggleLike('${article.id}', ${article.engagement?.user_liked || false})" class="${article.engagement?.user_liked ? 'success' : ''}" style="min-width: auto; padding: 8px 16px;">
                                    ${article.engagement?.user_liked ? '‚ù§Ô∏è Liked' : 'ü§ç Like'}
                                </button>
                                <button onclick="event.stopPropagation(); shareArticle('${article.id}')" class="${article.engagement?.user_shared ? 'warning' : ''}" style="min-width: auto; padding: 8px 16px;">
                                    ${article.engagement?.user_shared ? 'üì§ Shared' : 'üì§ Share'}
                                </button>
                                <button onclick="event.stopPropagation(); toggleBookmark('${article.id}', ${article.engagement?.user_bookmarked || false})" class="${article.engagement?.user_bookmarked ? 'success' : ''}" style="min-width: auto; padding: 8px 16px;">
                                    ${article.engagement?.user_bookmarked ? 'üîñ Bookmarked' : 'üìë Bookmark'}
                                </button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        async function getArticleDetails(articleId) {
            try {
                showStatus('Fetching article details...', 'info');
                const data = await makeRequest(`/articles/${articleId}`);
                
                showStatus('Article details fetched!', 'success');
                showResponse(data, `Article Details: ${data.title}`);
                
                // Track the view
                trackArticleView(articleId);
                
            } catch (error) {
                showStatus(`Failed to fetch article details: ${error.message}`, 'error');
            }
        }

        async function toggleLike(articleId, isCurrentlyLiked) {
            try {
                const method = isCurrentlyLiked ? 'DELETE' : 'POST';
                const action = isCurrentlyLiked ? 'unlike' : 'like';
                
                showStatus(`${isCurrentlyLiked ? 'Unliking' : 'Liking'} article...`, 'info');
                
                const data = await makeRequest(`/articles/${articleId}/like`, {
                    method: method
                });
                
                showStatus(`Article ${action}d successfully!`, 'success');
                showResponse(data, `${action.charAt(0).toUpperCase() + action.slice(1)} Response`);
                
                // Refresh articles to show updated status
                setTimeout(() => {
                    getArticles();
                }, 1000);
                
            } catch (error) {
                showStatus(`Failed to ${isCurrentlyLiked ? 'unlike' : 'like'} article: ${error.message}`, 'error');
            }
        }

        async function toggleBookmark(articleId, isCurrentlyBookmarked) {
            try {
                const method = isCurrentlyBookmarked ? 'DELETE' : 'POST';
                const action = isCurrentlyBookmarked ? 'remove bookmark from' : 'bookmark';
                
                showStatus(`${isCurrentlyBookmarked ? 'Removing bookmark from' : 'Bookmarking'} article...`, 'info');
                
                const data = await makeRequest(`/articles/${articleId}/bookmark`, {
                    method: method
                });
                
                showStatus(`Article ${action}ed successfully!`, 'success');
                showResponse(data, `Bookmark Response`);
                
                // Refresh articles to show updated status
                setTimeout(() => {
                    getArticles();
                }, 1000);
                
            } catch (error) {
                showStatus(`Failed to ${action} article: ${error.message}`, 'error');
            }
        }

        // Legacy function for backward compatibility
        async function likeArticle(articleId) {
            return toggleLike(articleId, false);
        }

        async function shareArticle(articleId) {
            try {
                showStatus('Sharing article...', 'info');
                
                const data = await makeRequest(`/articles/${articleId}/share`, {
                    method: 'POST',
                    body: JSON.stringify({
                        platform: 'demo',
                        message: 'Check out this article from the News Recommender demo!'
                    })
                });
                
                showStatus('Article shared successfully!', 'success');
                showResponse(data, 'Share Response');
                
                // Show share success info with enhanced features
                const container = document.getElementById('articles-container');
                const shareInfo = `
                    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #ffc107;">
                        <h4>üì§ Enhanced Article Sharing!</h4>
                        <p><strong>Share ID:</strong> ${data.share_id}</p>
                        <p><strong>Share URL:</strong> <a href="${data.share_url}" target="_blank">${data.share_url}</a></p>
                        <p><strong>Total Shares:</strong> ${data.total_shares} (across all users)</p>
                        <div style="margin-top: 10px; padding: 10px; background: #e7f3ff; border-radius: 6px;">
                            <strong>üÜï New Features:</strong>
                            <ul style="margin: 8px 0; padding-left: 20px;">
                                <li><strong>Enhanced Messages:</strong> Article title automatically included in share message!</li>
                                <li><strong>Share Counting:</strong> Multiple shares from same user now increment count</li>
                                <li><strong>Individual Tracking:</strong> Each user's share count tracked separately</li>
                            </ul>
                        </div>
                        <div style="margin-top: 10px; padding: 10px; background: #e7f3ff; border-radius: 6px;">
                            <strong>üß† ML Insight:</strong> Shares are the strongest engagement signal! Multiple shares from the same user 
                            indicate very high interest and dramatically boost recommendation weights. Try sharing the same article again 
                            to see the count increment!
                        </div>
                    </div>
                `;
                
                // Append to existing content or create new
                if (container.innerHTML.includes('üì∞ Articles')) {
                    container.innerHTML = container.innerHTML.replace('</div>', shareInfo + '</div>');
                } else {
                    container.innerHTML = shareInfo + container.innerHTML;
                }
                
                // Refresh articles to show updated share status
                setTimeout(() => {
                    getArticles();
                }, 2000);
                
            } catch (error) {
                showStatus(`Failed to share article: ${error.message}`, 'error');
            }
        }

        async function trackArticleView(articleId) {
            try {
                const data = await makeRequest(`/articles/${articleId}/view`, {
                    method: 'POST',
                    body: JSON.stringify({
                        view_duration_seconds: 45,
                        percentage_read: 75,
                        interaction_type: 'click'
                    })
                });
                
                console.log('View tracked:', data);
                
            } catch (error) {
                console.error('Failed to track view:', error);
            }
        }

        async function getUserProfile() {
            try {
                showStatus('Fetching user profile...', 'info');
                const data = await makeRequest('/users/profile');
                
                showStatus('Profile fetched successfully!', 'success');
                showResponse(data, 'User Profile');
                
            } catch (error) {
                showStatus(`Failed to fetch profile: ${error.message}`, 'error');
            }
        }

        async function updateProfile() {
            const newDisplayName = prompt('Enter new display name:');
            const newBio = prompt('Enter bio:');
            
            if (!newDisplayName && !newBio) {
                showStatus('No changes made', 'info');
                return;
            }
            
            try {
                showStatus('Updating profile...', 'info');
                const updateData = {};
                if (newDisplayName) updateData.display_name = newDisplayName;
                if (newBio) updateData.bio = newBio;
                
                const data = await makeRequest('/users/profile', {
                    method: 'PUT',
                    body: JSON.stringify(updateData)
                });
                
                showStatus('Profile updated successfully!', 'success');
                showResponse(data, 'Updated Profile');
                
            } catch (error) {
                showStatus(`Failed to update profile: ${error.message}`, 'error');
            }
        }

        async function getUserBookmarks() {
            try {
                showStatus('Fetching bookmarks...', 'info');
                const data = await makeRequest('/users/bookmarks');
                
                showStatus('Bookmarks fetched successfully!', 'success');
                showResponse(data, 'User Bookmarks API Response');
                
                // Display bookmarks in a nice format
                displayBookmarks(data.bookmarks || []);
                
            } catch (error) {
                showStatus(`Failed to fetch bookmarks: ${error.message}`, 'error');
            }
        }

        function displayBookmarks(bookmarks) {
            const container = document.getElementById('articles-container');
            
            if (!bookmarks || bookmarks.length === 0) {
                container.innerHTML = '<h3>üìë My Bookmarks</h3><p>You haven\'t bookmarked any articles yet. Bookmark some articles and they\'ll appear here!</p>';
                return;
            }
            
            container.innerHTML = `
                <h3>üìë My Bookmarks (${bookmarks.length} articles):</h3>
                <div class="articles-grid">
                    ${bookmarks.map(bookmark => {
                        const article = bookmark.article;
                        return `
                            <div class="article-card bookmarked" onclick="getArticleDetails('${article.id}')">
                                <div class="article-title">${article.title}</div>
                                <div class="article-summary">${article.summary || 'No summary available'}</div>
                                <div class="article-meta">
                                    <span>üì∞ ${article.source?.name || 'Unknown'}</span>
                                    <span>üëÄ ${article.engagement?.views || 0} views</span>
                                    <span>‚ù§Ô∏è ${article.engagement?.likes || 0} likes</span>
                                    <span>üîñ Bookmarked on ${new Date(bookmark.bookmarked_at).toLocaleDateString()}</span>
                                </div>
                                <div style="margin-top: 10px; display: flex; gap: 8px; flex-wrap: wrap;">
                                    <button onclick="event.stopPropagation(); toggleLike('${article.id}', ${article.engagement?.user_liked || false})" class="${article.engagement?.user_liked ? 'success' : ''}" style="min-width: auto; padding: 8px 16px;">
                                        ${article.engagement?.user_liked ? '‚ù§Ô∏è Liked' : 'ü§ç Like'}
                                    </button>
                                    <button onclick="event.stopPropagation(); shareArticle('${article.id}')" class="${article.engagement?.user_shared ? 'warning' : ''}" style="min-width: auto; padding: 8px 16px;">
                                        ${article.engagement?.user_shared ? 'üì§ Shared' : 'üì§ Share'}
                                    </button>
                                    <button onclick="event.stopPropagation(); toggleBookmark('${article.id}', true)" class="danger" style="min-width: auto; padding: 8px 16px;">
                                        üóëÔ∏è Remove Bookmark
                                    </button>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        async function getEmbeddingStatus() {
            try {
                showStatus('Fetching embedding status...', 'info');
                const data = await makeRequest('/users/embedding/status');
                
                showStatus('Embedding status fetched!', 'success');
                showResponse(data, 'Embedding Status');
                
            } catch (error) {
                showStatus(`Failed to fetch embedding status: ${error.message}`, 'error');
            }
        }

        async function testEmbeddingUpdate() {
            try {
                showStatus('Generating test embedding update...', 'info');
                
                // Generate a random 384-dimensional embedding vector
                const embeddingVector = Array.from({length: 384}, () => Math.random() * 2 - 1);
                
                // Create test interaction summary
                const testPayload = {
                    embedding_vector: embeddingVector,
                    interaction_summary: {
                        avg_read_time_seconds: 120.5 + Math.random() * 60,
                        engagement_metrics: {
                            liked_articles: Math.floor(Math.random() * 10),
                            shared_articles: Math.floor(Math.random() * 5),
                            bookmarked_articles: Math.floor(Math.random() * 8),
                            skipped_articles: Math.floor(Math.random() * 3)
                        },
                        category_exposure: {
                            technology: Math.floor(Math.random() * 15),
                            business: Math.floor(Math.random() * 10),
                            health: Math.floor(Math.random() * 8),
                            sports: Math.floor(Math.random() * 5),
                            entertainment: Math.floor(Math.random() * 12)
                        }
                    },
                    session_start: new Date(Date.now() - 3600000).toISOString(), // 1 hour ago
                    session_end: new Date().toISOString(),
                    articles_processed: Math.floor(Math.random() * 20) + 5,
                    device_type: 'web_demo',
                    app_version: '1.0.0'
                };
                
                showStatus('Sending embedding update...', 'info');
                
                const data = await makeRequest('/users/embedding/update', {
                    method: 'POST',
                    body: JSON.stringify(testPayload)
                });
                
                showStatus('Embedding updated successfully!', 'success');
                showResponse(data, 'Embedding Update Response');
                
                // Show a summary of what was updated
                const container = document.getElementById('articles-container');
                container.innerHTML = `
                    <h3>üß† Embedding Update Test Results</h3>
                    <div style="background: #e8f5e8; padding: 20px; border-radius: 8px; margin: 15px 0;">
                        <h4>‚úÖ Update Successful!</h4>
                        <p><strong>Personalization Score:</strong> ${(data.personalization_score * 100).toFixed(1)}%</p>
                        <p><strong>Diversity Adjustment:</strong> ${data.diversity_adjustment}</p>
                        <p><strong>Recommendations Refreshed:</strong> ${data.recommendations_refreshed ? 'Yes' : 'No'}</p>
                        <p><strong>Articles Processed:</strong> ${testPayload.articles_processed}</p>
                        <p><strong>Session Duration:</strong> ${Math.round((new Date(testPayload.session_end) - new Date(testPayload.session_start)) / 60000)} minutes</p>
                        
                        <h5>Engagement Metrics:</h5>
                        <ul>
                            <li>‚ù§Ô∏è Liked: ${testPayload.interaction_summary.engagement_metrics.liked_articles}</li>
                            <li>üì§ Shared: ${testPayload.interaction_summary.engagement_metrics.shared_articles}</li>
                            <li>üîñ Bookmarked: ${testPayload.interaction_summary.engagement_metrics.bookmarked_articles}</li>
                            <li>‚è≠Ô∏è Skipped: ${testPayload.interaction_summary.engagement_metrics.skipped_articles}</li>
                        </ul>
                        
                        <h5>Category Exposure:</h5>
                        <ul>
                            ${Object.entries(testPayload.interaction_summary.category_exposure)
                                .map(([category, count]) => `<li>${category}: ${count} articles</li>`)
                                .join('')}
                        </ul>
                        
                        <p style="margin-top: 15px; font-size: 0.9em; color: #666;">
                            üí° <strong>Tip:</strong> In a real app, this embedding would be computed on the user's device 
                            based on their actual reading behavior and sent to the server every ~10 articles for 
                            improved personalized recommendations.
                        </p>
                    </div>
                `;
                
            } catch (error) {
                showStatus(`Failed to update embedding: ${error.message}`, 'error');
            }
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            showStatus('Ready! Please login or register to test the API.', 'info');
        });
    </script>
</body>
</html> 